;; Compile Options : /TML610178A /ML /near /Icommon /Imain /Iirq /Itimer /Iclock /Itbc /Ipwm /Iuart /Ivolume /Iled /D_ML610Q178 /SS 256 /SD /Oa /Ot /W 3 /Wc /Fa_output\_obj\ 
;; Version Number  : Ver.3.31.4
;; File Name       : uart.c

	type (ML610178A) 
	model large, near
	$$_send_byte$uart segment code 2h any
	$$uartInit$uart segment code 2h any
	$$uartSendStr$uart segment code 2h any
CVERSION 3.31.4
CSGLOBAL 03H 0000H "_send_byte" 08H 02H 02H 00H 80H 00H 00H 00H 07H
CGLOBAL 01H 03H 0000H "uartSendStr" 08H 02H 01H 00H 81H 0cH 00H 00H 07H
CGLOBAL 01H 03H 0000H "uartInit" 08H 02H 00H 00H 80H 00H 00H 00H 07H
CSTRUCTTAG 0000H 0000H 0000H 0008H 00000001H "_Notag"
CSTRUCTMEM 52H 00000001H 00000000H "b0" 02H 00H 00H
CSTRUCTMEM 52H 00000001H 00000001H "b1" 02H 00H 00H
CSTRUCTMEM 52H 00000001H 00000002H "b2" 02H 00H 00H
CSTRUCTMEM 52H 00000001H 00000003H "b3" 02H 00H 00H
CSTRUCTMEM 52H 00000001H 00000004H "b4" 02H 00H 00H
CSTRUCTMEM 52H 00000001H 00000005H "b5" 02H 00H 00H
CSTRUCTMEM 52H 00000001H 00000006H "b6" 02H 00H 00H
CSTRUCTMEM 52H 00000001H 00000007H "b7" 02H 00H 00H
CTYPEDEF 0000H 0000H 43H "_BYTE_FIELD" 04H 00H 05H 00H 00H
CFILE 0001H 00000027H "common\\common.h"
CFILE 0002H 00000020H "main\\mcu.h"
CFILE 0003H 000008AAH "main\\ml610178A.h"
CFILE 0004H 0000001FH "uart\\uart.h"
CFILE 0000H 0000005AH "uart\\uart.c"

	rseg $$uartInit$uart
CFUNCTION 0

_uartInit	:
CBLOCK 0 1 42

;;{
CLINEA 0000H 0001H 002AH 0001H 0001H
CBLOCK 0 2 42

;;	P43DIR = 0;	// output
CLINEA 0000H 0001H 002BH 0002H 0016H
	rb	0f221h.3

;;	P43C0 = 1;
CLINEA 0000H 0001H 002CH 0002H 000BH
	sb	0f222h.3

;;	P43C1 = 1;	// cmos
CLINEA 0000H 0001H 002DH 0002H 0013H
	sb	0f223h.3

;;	P43MD0 = 1;
CLINEA 0000H 0001H 002EH 0002H 000CH
	sb	0f224h.3

;;	P43MD1 = 0;	// uart0 data output
CLINEA 0000H 0001H 002FH 0002H 0021H
	rb	0f225h.3

;;	U0EN = 0;	// stop
CLINEA 0000H 0001H 0031H 0002H 0012H
	rb	0f291h.0

;;	U0IO = 0;	// send mode
CLINEA 0000H 0001H 0033H 0002H 0017H
	rb	0f292h.0

;;	U0CK0 = 0;
CLINEA 0000H 0001H 0034H 0002H 000BH
	rb	0f292h.1

;;	U0CK1 = 1;	// hsclk
CLINEA 0000H 0001H 0035H 0002H 0014H
	sb	0f292h.2

;;	U0RSEL = 1;	// recv pin = P42
CLINEA 0000H 0001H 0036H 0002H 001EH
	sb	0f292h.4

;;	U0LG0 = 0;
CLINEA 0000H 0001H 0038H 0002H 000BH
	rb	0f293h.0

;;	U0LG1 = 0;	// data 8bit
CLINEA 0000H 0001H 0039H 0002H 0018H
	rb	0f293h.1

;;	U0PT0 = 0;
CLINEA 0000H 0001H 003AH 0002H 000BH
	rb	0f293h.2

;;	U0PT1 = 1;	// parity none
CLINEA 0000H 0001H 003BH 0002H 001AH
	sb	0f293h.3

;;	U0STP = 0;	// stop 1bit
CLINEA 0000H 0001H 003CH 0002H 0018H
	rb	0f293h.4

;;	U0NEG = 0;	// positive
CLINEA 0000H 0001H 003DH 0002H 0017H
	rb	0f293h.5

;;	U0DIR = 0;	// LSB first
CLINEA 0000H 0001H 003EH 0002H 0018H
	rb	0f293h.6

;;	UA0BRT = ( unsigned short )( ( ( HSCLK_kHZ * 1000UL ) / UART_BAUDRATE ) - 1 );
CLINEA 0000H 0001H 0040H 0002H 004FH
	mov	r0,	#045h
	mov	r1,	#00h
	st	er0,	0f294h
CBLOCKEND 0 2 65

;;}
CLINEA 0000H 0001H 0041H 0001H 0001H
	rt
CBLOCKEND 0 1 65
CFUNCTIONEND 0


	rseg $$uartSendStr$uart
CFUNCTION 1

_uartSendStr	:
CBLOCK 1 1 68

;;{
CLINEA 0000H 0001H 0044H 0001H 0001H
	push	lr
	push	xr8
	push	xr4
	mov	er8,	er0
	mov	r10,	r2
CBLOCK 1 2 68
CRET 0008H
CARGUMENT 47H 0002H 0028H "str" 04H 03H 00H 00H 00H
CARGUMENT 46H 0001H 001EH "num" 02H 00H 00H
CLOCAL 46H 0001H 0018H 0002H "i" 02H 00H 00H
CLOCAL 46H 0002H 0027H 0002H "ptr" 04H 03H 00H 00H 00H

;;	unsigned char i = 0;
CLINEA 0000H 0001H 0045H 0002H 0015H
	mov	r4,	#00h

;;	unsigned char* ptr = (unsigned char*)str;
CLINEA 0000H 0001H 0046H 0002H 002AH
	mov	er6,	er8

;;	while( i < num )
CLINEA 0000H 0001H 0048H 0002H 0011H
	bal	_$L2
_$L4 :
CBLOCK 1 3 73

;;		_send_byte( *(ptr+i) );
CLINEA 0000H 0001H 004AH 0003H 0019H
	mov	r0,	r4
	mov	r1,	#00h
	add	er0,	er6
	l	r0,	[er0]
	bl	__send_byte

;;		i++;
CLINEA 0000H 0000H 004BH 0003H 0006H
	add	r4,	#01h
CBLOCKEND 1 3 76

;;	}
CLINEA 0000H 0000H 004CH 0002H 0002H
_$L2 :

;;	while( i < num )
CLINEA 0000H 0000H 0048H 0000H 0000H
	cmp	r4,	r10
	blt	_$L4
CBLOCKEND 1 2 77

;;}
CLINEA 0000H 0001H 004DH 0001H 0001H
	pop	xr4
	pop	xr8
	pop	pc
CBLOCKEND 1 1 77
CFUNCTIONEND 1


	rseg $$_send_byte$uart
CFUNCTION 2

__send_byte	:
CBLOCK 2 1 80

;;{
CLINEA 0000H 0001H 0050H 0001H 0001H
CBLOCK 2 2 80
CARGUMENT 46H 0001H 0014H "c" 02H 00H 00H

;;	U0IO = 0;			/* 送信モード */
CLINEA 0000H 0001H 0051H 0002H 001DH
	rb	0f292h.0

;;	UA0BUF = c;			/* 送信データ */
CLINEA 0000H 0001H 0052H 0002H 001FH
	st	r0,	0f290h

;;	U0EN = 1;			/* 送信開始 */
CLINEA 0000H 0001H 0053H 0002H 001BH
	sb	0f291h.0

;;	while(U0EN != 0)		/* 送信完了待ち */
CLINEA 0000H 0000H 0054H 0002H 0025H
_$L9 :
CBLOCK 2 3 85
CBLOCKEND 2 3 87
	tb	0f291h.0
	bne	_$L9

;;	QUA0 = 0;			/* 割込み要求クリア */
CLINEA 0000H 0001H 0058H 0002H 0023H
	rb	0f01ch.0
CBLOCKEND 2 2 89

;;}
CLINEA 0000H 0001H 0059H 0001H 0001H
	rt
CBLOCKEND 2 1 89
CFUNCTIONEND 2

	public _uartSendStr
	public _uartInit
	extrn code far : _main

	end
